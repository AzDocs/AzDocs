[[_TOC_]]

# Description

This snippet will create an Azure Container Instances instance for you. It will be integrated into the given subnet.

# Parameters

Some parameters from [General Parameter](/Azure/Azure-CLI-Snippets) list.

| Parameter                                | Required                        | Example Value                                                              | Description                                                                                                                                                                                                                               | --- |
| ---------------------------------------- | ------------------------------- | -------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --- |
| ContainerName                            | <input type="checkbox" checked> | `mycontainername`                                                          | The name of the container instance.                                                                                                                                                                                                       |
| ContainerResourceGroupName               | <input type="checkbox" checked> | `Myteam-MyApp-$(Release.EnvironmentName)`                                  | The resourcegroup where the container should be.                                                                                                                                                                                          |
| ContainerCpuCount                        | <input type="checkbox" checked> | `4`                                                                        | The amount of CPU-cores the container should be able to use.                                                                                                                                                                              |
| ContainerMemoryInGb                      | <input type="checkbox" checked> | `8`                                                                        | The amount of memory your container may use. Expressed in GB's.                                                                                                                                                                           |
| ContainerOs                              | <input type="checkbox" checked> | `Linux`                                                                    | The OS which is used in & underneath the container. Can be either `Linux` or `Windows`.                                                                                                                                                   |
| ContainerPorts                           | <input type="checkbox" checked> | `80 443`                                                                   | Space delimited list of ports you want to expose to the container.                                                                                                                                                                        |
| ContainerImageName                       | <input type="checkbox" checked> | `myacr.azurecr.io/mycompany/myimage:latest`                                | The image name to use. Please refer to [this docker documentation](https://docs.docker.com/engine/reference/commandline/tag/) for information about image & tag naming.                                                                   |
| ContainerSubnetName                      | <input type="checkbox">         | `my-subnet-123`                                                            | The subnetname for the subnet where the container should land in.                                                                                                                                                                         |
| ImageRegistryLoginServer                 | <input type="checkbox">         | `myacr.azurecr.io`                                                         | OPTIONAL: The address of the registry login server. This is usualy the address of the image repository itself.                                                                                                                            |
| ImageRegistryUserName                    | <input type="checkbox">         | `myuser`                                                                   | The username to use to authenticate against the image registry.                                                                                                                                                                           |
| ImageRegistryPassword                    | <input type="checkbox">         | `S0m3S3cre7P@ssw0rd123!`                                                   | The password to use to authenticate against the image registry.                                                                                                                                                                           |
| ContainerEnvironmentVariables            | <input type="checkbox" >        | `'ENVIRONMENT="ACC";SOMECONNECTIONSTRING="THISISMYCONNECTIONSTRING"`       | A list of environmentvariables which should be made available inside the container. This should be delimited by the value from `ContainerEnvironmentVariablesDelimiter`.                                                                  |
| ContainerEnvironmentVariablesDelimiter   | <input type="checkbox">         | `;`                                                                        | This is the delimiter for `ContainerEnvironmentVariables`. This defaults to `;`.                                                                                                                                                          |
| StorageAccountFileShareName              | <input type="checkbox">         | `myfileshare`                                                              | The name of the fileshare inside the storage account.                                                                                                                                                                                     |
| FileShareStorageAccountName              | <input type="checkbox">         | `mystorageaccount`                                                         | The name of the storage accountname where the fileshare resides in.                                                                                                                                                                       |
| FileShareStorageAccountResourceGroupName | <input type="checkbox">         | `MyTeam-MyApp-$(Release.EnvironmentName)`                                  | The resourcegroupname of the resourcegroup where the storageaccount resides in.                                                                                                                                                           |
| StorageAccountFileShareMountPath         | <input type="checkbox">         | `/var/log/someapp`                                                         | The path to mount the given fileshare inside the container.                                                                                                                                                                               |
| LogAnalyticsWorkspaceId                  | <input type="checkbox">         | `225c2873-c15f-42da-a5d2-0dfb3df76da0`                                     | The log analytics workspace Id                                                                                                                                                                                                            |
| LogAnalyticsWorkspaceKey                 | <input type="checkbox">         | `RGl0IGlzIGVlbiBvbmdlbGRpZ2UgdG9rZW4g8J+YgfCfmIHwn5iB8J+YgfCfmIHwn5iBLg==` | Primary or Secondary Key of the log analytics workspace.                                                                                                                                                                                  |
| ContainerVnetName                        | <input type="checkbox">         | `my-vnet-$(Release.EnvironmentName)`                                       | The name of the VNET where your container resides in.                                                                                                                                                                                     |
| ContainerVnetResourceGroupName           | <input type="checkbox">         | `sharedservices-rg`                                                        | The ResourceGroup where your VNET, for your container, resides in.                                                                                                                                                                        |
| ContainerIpAddressType                   | <input type="checkbox">         | `Private` \ `Public`                                                       | The ip address type of your container. You can choose between 'Private' or 'Public'. When choosing 'Private', make sure to add ContainerVnetName, ContainerVnetResourceGroupName and ContainerSubnetName.                                 |
| ForcePublic                              | <input type="checkbox">         | n.a.                                                                       | If you are not using any networking settings, you need to pass this boolean to confirm you are willingly creating a public resource (to avoid unintended public resources). You can pass it as a switch without a value (`-ForcePublic`). |

# YAML

Be aware that this YAML example contains all parameters that can be used with this script. You'll need to pick and choose the parameters that are needed for your desired action.

```yaml
        - task: AzureCLI@2
           displayName: 'Create Container'
           condition: and(succeeded(), eq(variables['DeployInfra'], 'true'))
           inputs:
               azureSubscription: '${{ parameters.SubscriptionName }}'
               scriptType: pscore
               scriptPath: '$(Pipeline.Workspace)/AzDocs/Container-Instance/Create-Container.ps1'
               arguments: "-ContainerName '$(ContainerName)' -ContainerResourceGroupName '$(ContainerResourceGroupName)' -ContainerCpuCount '$(ContainerCpuCount)' -ContainerMemoryInGb '$(ContainerMemoryInGb)' -ContainerOs '$(ContainerOs)' -ContainerPorts '$(ContainerPorts)' -ContainerImageName '$(ContainerImageName)' -ContainerVnetName '$(ContainerVnetName)' -ContainerVnetResourceGroupName '$(ContainerVnetResourceGroupName)' -ContainerSubnetName '$(ContainerSubnetName)' -ImageRegistryLoginServer '$(ImageRegistryLoginServer)' -ImageRegistryUserName '$(ImageRegistryUserName)' -ImageRegistryPassword '$(ImageRegistryPassword)' -ContainerEnvironmentVariables '$(ContainerEnvironmentVariables)' -ContainerEnvironmentVariablesDelimiter '$(ContainerEnvironmentVariablesDelimiter)' -StorageAccountFileShareName '$(StorageAccountFileShareName)' -FileShareStorageAccountName '$(FileShareStorageAccountName)' -FileShareStorageAccountResourceGroupName '$(FileShareStorageAccountResourceGroupName)' -StorageAccountFileShareMountPath '$(StorageAccountFileShareMountPath)' -LogAnalyticsWorkspaceId '$(LogAnalyticsWorkspaceId)' -LogAnalyticsWorkspaceKey '$(LogAnalyticsWorkspaceKey)' -ContainerIpAddressType '$(ContainerIpAddressType)'"
```

# Code

[Click here to download this script](../../../../src/Container-Instance/Create-Container.ps1)

# Links

[Azure CLI - az network vnet show](https://docs.microsoft.com/en-us/cli/azure/network/vnet?view=azure-cli-latest#az_network_vnet_show)

[Azure CLI - az container create](https://docs.microsoft.com/en-us/cli/azure/container?view=azure-cli-latest#az_container_create)
