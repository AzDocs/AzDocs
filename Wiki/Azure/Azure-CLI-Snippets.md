[[_TOC_]]

# Introduction

In this chapter some Azure CLI snippets are shared which can be used in your Azure DevOps pipelines for interacting with Azure Resources. Use the "Azure CLI" step with Powershell Core as script type unless stated elsewise. We recommend making Task Groups which have a CLI step with a reference to those snippets when you use classic pipelines. Also please take in consideration we have standarized the naming. So if you don't modify these scripts 1:1 you will be able to receive easy updates in the future!

Please feel free to contribute to this using pull requests on this wiki (The source is in the repository in this teamproject).

# System Variables

Azure DevOps has some system variables which you can use. The most important one you will see in this wiki will be the `$(Release.EnvironmentName)` variable. This variable will be replaced during your releases with the environmentname you have entered in the pipeline. We recommend sticking to the `dev`/`acc`/`prod` naming convention which is used across the entirety of Azure). This will allow you to keep your variables way smaller & easier (up to 1/4 of what you would need without using this trick).

[A full list of system variables can be found here](https://docs.microsoft.com/en-us/azure/devops/pipelines/release/variables?view=azure-devops&tabs=batch)

# General Parameters

In some CLI scripts some standarized namings have been used. You can find the list of standard namings below.

| Parameter             | Example Value                                                                                                                                                                                                                                                                                   | Description                                                                                                                                                                                           |
| --------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Location              | `West Europe`/`westeurope`                                                                                                                                                                                                                                                                      | Defines the Azure Location for a resource (group) to be in (you can use `az account list-locations -o table` to get a list of locations you can use)                                                  |
| SubscriptionName      | `MY SUBSCRIPTION $(Release.EnvironmentName)`                                                                                                                                                                                                                                                    | The Service Connection Name for the subscription to deploy resources in. It's recommended to use the Subscriptionname as the Service Connection name.                                                 |
| ResourceGroupName     | `MyTeam-SomeApi-$(Release.EnvironmentName)`                                                                                                                                                                                                                                                     | The resourcegroup to deploy to or to create. We generally use `<Team>-<Product>-$(Release.EnvironmentName)` for this.                                                                                 |
| VnetName              | `my-vnet-$(Release.EnvironmentName)`                                                                                                                                                                                                                                                            | The name of the VNET to use for your resource.                                                                                                                                                        |
| VnetResourceGroupName | `sharedservices-rg`                                                                                                                                                                                                                                                                             | The ResourceGroup where your VNET resides in. If you are unsure use `sharedservices-rg`                                                                                                               |
| ResourceTags          | `@("BillingIdentifier=$(Tag.BillingIdentifier)"; "EnvironmentType=$(Tag.EnvironmentType)"; "ApplicationName=$(Tag.ApplicationName)"; "AppTechOwner=$(Tag.AppTechOwner)"; "ApplicationOwner=$(Tag.ApplicationOwner)"; "ApplicationID=$(Tag.ApplicationID)"; "BusinessUnit=$(Tag.BusinessUnit)")` | The Azure tags to use for this resource. This has to be a powershell object array (Can be defined with `@("Tagname=Value";"AnotherTagname=Value2")`. Make sure to NOT enclose this value with quotes. |
| Tag.BillingIdentifier | `123456`                                                                                                                                                                                                                                                                                        | The billing identifier. This is the centercode of your department.                                                                                                                                    |
| Tag.EnvironmentType   | `$(Release.EnvironmentName)`                                                                                                                                                                                                                                                                    | The environmentname for this environment. We generally use `$(Release.EnvironmentName)` for this to let it be the same as the DevOps pipeline environmentname.                                        |
| Tag.ApplicationName   | `SOME APPNAME`                                                                                                                                                                                                                                                                                  | The CMDB Application Name                                                                                                                                                                             |
| Tag.AppTechOwner      | `techowner@company.com`                                                                                                                                                                                                                                                                         | The technical owner. This is generally the team e-mailaddress                                                                                                                                         |
| Tag.ApplicationOwner  | `myproductowner@company.com`                                                                                                                                                                                                                                                                    | The owner of the application. This is generally the productowner of the team                                                                                                                          |
| Tag.ApplicationID     | `1234`                                                                                                                                                                                                                                                                                          | The CMDB Application ID                                                                                                                                                                               |
| Tag.BusinessUnit      | `My Departmentname`                                                                                                                                                                                                                                                                             | This is the departmentname where you reside in.                                                                                                                                                       |
